<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>miceFast - Introduction • miceFast</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="miceFast - Introduction">
<meta property="og:description" content="miceFast">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">miceFast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/miceFast-intro.html">miceFast - Introduction</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Polkas/miceFast/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>miceFast - Introduction</h1>
                        <h4 class="author">Maciej Nasinski</h4>
            
            <h4 class="date">2020-05-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Polkas/miceFast/blob/master/vignettes/miceFast-intro.Rmd"><code>vignettes/miceFast-intro.Rmd</code></a></small>
      <div class="hidden name"><code>miceFast-intro.Rmd</code></div>

    </div>

    
    
<p>Loading the package and setting a seed:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">pkgs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'miceFast'</span>,<span class="st">'data.table'</span>,<span class="st">'magrittr'</span>,<span class="st">'mice'</span>,<span class="st">'car'</span>,<span class="st">'dplyr'</span>,<span class="st">'ggplot2'</span>)
<span class="no">inst</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">pkgs</span>, <span class="no">library</span>, <span class="kw">character.only</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123456</span>)</pre></body></html></div>
<div id="description" class="section level2">
<h2 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h2>
<p>Fast imputations under the object-oriented programming paradigm. There was used quantitative models with a closed-form solution. Thus package is based on linear algebra operations. The biggest improvement in time performance could be achieve for a calculation where a grouping variable have to be used. A single evaluation of a quantitative model for the multiple imputations is another major enhancement. Moreover there are offered a few functions built to work with popular R packages.</p>
</div>
<div id="performance" class="section level2">
<h2 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h2>
<p>miceFast was compared<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> with the mice package. For grouping option there was used a basic R looping and popular dplyr/data.table packages. Summing up, miceFast offer a relevant reduction of a calculations time for:</p>
<ul>
<li>Linear Discriminant Analysis around <strong>(x5)</strong>
</li>
<li>where a grouping variable have to be used <strong>(around x10 depending on data dimensions and number of groups and even more than x100 although compared to data.table only a few times faster or even the same)</strong> because of pre-sorting by grouping variable</li>
<li>multiple imputations is faster around <strong>x(a number of multiple imputations)</strong> because the core of a model is evaluated only ones.</li>
<li>Variance inflation factors (VIF) <strong>(x5)</strong> because the unnecessary linear regression is not evaluated - we need only inverse of X’X</li>
</ul>
<p>Example (2019-08-07):</p>
<div class="figure">
<img src="../inst/extdata/images/g_summary.png" alt="Performance Summary"><p class="caption">Performance Summary</p>
</div>
<p>If you are interested about the procedure of testing performance check performance_validity.R file at the extdata folder.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"performance_validity.R"</span>,<span class="kw">package</span> <span class="kw">=</span> <span class="st">"miceFast"</span>)</pre></body></html></div>
<p>Additional plots for simulations with certain parameters (but feel free to change them) are located:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"images"</span>,<span class="kw">package</span> <span class="kw">=</span> <span class="st">"miceFast"</span>)</pre></body></html></div>
<p>Moreover there are offered a few functions built to work with the popular R packages such as ‘data.table’.</p>
</div>
<div id="motivations" class="section level2">
<h2 class="hasAnchor">
<a href="#motivations" class="anchor"></a>Motivations</h2>
<p>Missing data is a common problem. The easiest solution is to delete observations for which a certain variable is missing. However this will sometimes deteriorate quality of a project. Another solution will be to use methods such as multiple/regular imputations to fill the missing data. Non missing independent variables could be used to approximate a missing observations for a dependent variable. R or Python language are user-friendly for data manipulation but parallely brings slower computations. Languages such as C++ gives an opportunity to boost our applications or projects.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="introduction-for-data-tabledplyr-users---using-additional-functions-from-micefast" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-for-data-tabledplyr-users---using-additional-functions-from-micefast" class="anchor"></a>Introduction for data.table/dplyr users - using additional functions from miceFast:</h2>
<p>Usage of <code>fill_NA</code> and <code>fill_NA_N</code> functions from miceFast - this functions should be resistant to glitches from an user activity perspective and a data structure.</p>
<div id="data" class="section level3">
<h3 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h3>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># airquality dataset with additional variables</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">air_miss</span>)</pre></body></html></div>
</div>
<div id="intro-data-table" class="section level3">
<h3 class="hasAnchor">
<a href="#intro-data-table" class="anchor"></a>Intro: data.table</h3>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># VIF - values bigger than 10 (around) suggest that there might be a collinearity problem.</span>
<span class="co"># VIF is high for Solar.R and x_character which is obvious - x_character is a factor version of numeric Solar.R</span>
<span class="no">air_miss</span>[,<span class="fu">.</span>(<span class="fu"><a href="../reference/VIF.html">VIF</a></span>(<span class="no">.SD</span>,<span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                   <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Solar.R'</span>,
                             <span class="st">'Wind'</span>,
                             <span class="st">'Temp'</span>,
                             <span class="st">'x_character'</span>,
                             <span class="st">'Day'</span>,
                             <span class="st">'weights'</span>,
                             <span class="st">'groups'</span>)))]</pre></body></html></div>
<pre><code>##           V1
## 1: 24.978996
## 2:  1.445308
## 3:  3.077776
## 4: 42.248792
## 5:  1.083795
## 6:  1.100853
## 7:  2.954588</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># IMPUTATIONS</span>
<span class="co"># Imputations with a grouping option (models are separately assessed for each group) </span>
<span class="co"># taking into account provided weights</span>
<span class="no">air_miss</span>[,<span class="no">Solar_R_imp</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA_N.html">fill_NA_N</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                                   <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                                   <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Solar.R'</span>,
                                   <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Wind'</span>,<span class="st">'Temp'</span>,<span class="st">'Intercept'</span>),
                                   <span class="kw">w</span><span class="kw">=</span><span class="no">.SD</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                                   <span class="kw">times</span><span class="kw">=</span><span class="fl">100</span>),<span class="kw">by</span><span class="kw">=</span><span class="fu">.</span>(<span class="no">groups</span>)] <span class="kw">%&gt;%</span>
<span class="co"># Imputations - discrete variable</span>
  <span class="no">.</span>[,<span class="no">x_character_imp</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                                <span class="kw">model</span><span class="kw">=</span><span class="st">"lda"</span>,
                                <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'x_character'</span>,
                                <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Wind'</span>,<span class="st">'Temp'</span>,<span class="st">'groups'</span>))] <span class="kw">%&gt;%</span>
<span class="co"># logreg was used because almost log-normal distribution of Ozone</span>
<span class="co"># imputations around mean</span>
<span class="no">.</span>[,<span class="no">Ozone_imp1</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                         <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                         <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                         <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>),
                         <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>)] <span class="kw">%&gt;%</span>
<span class="co"># imputations using positions - Intercept, Temp</span>
<span class="no">.</span>[,<span class="no">Ozone_imp2</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                         <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                         <span class="kw">posit_y</span><span class="kw">=</span><span class="fl">1</span>,
                         <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">6</span>),
                         <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>)] <span class="kw">%&gt;%</span>
<span class="co"># model with a factor independent variable </span>
<span class="co"># multiple imputations (average of x30 imputations) </span>
<span class="co"># with a factor independent variable, weights and logreg options</span>
  <span class="no">.</span>[,<span class="no">Ozone_imp3</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA_N.html">fill_NA_N</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                             <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_noise"</span>,
                             <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                             <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                             <span class="kw">w</span><span class="kw">=</span><span class="no">.SD</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                             <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>,
                             <span class="kw">times</span><span class="kw">=</span><span class="fl">30</span>)] <span class="kw">%&gt;%</span>
  <span class="no">.</span>[,<span class="no">Ozone_imp4</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA_N.html">fill_NA_N</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                             <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                             <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                             <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                             <span class="kw">w</span><span class="kw">=</span><span class="no">.SD</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                             <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>,
                             <span class="kw">times</span><span class="kw">=</span><span class="fl">30</span>)] <span class="kw">%&gt;%</span>
  <span class="no">.</span>[,<span class="no">Ozone_imp5</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                           <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_pred"</span>,
                           <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                           <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                           <span class="kw">w</span><span class="kw">=</span><span class="no">.SD</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                           <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>),<span class="fu">.</span>(<span class="no">groups</span>)] <span class="kw">%&gt;%</span>

<span class="co"># Average of a few methods</span>
  <span class="no">.</span>[,<span class="no">Ozone_imp_mix</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">.SD</span>,<span class="fl">1</span>,<span class="no">mean</span>),<span class="kw">.SDcols</span><span class="kw">=</span><span class="no">Ozone_imp1</span>:<span class="no">Ozone_imp5</span>] <span class="kw">%&gt;%</span>

<span class="co"># Protecting against collinearity or low number of observations - across small groups</span>
<span class="co"># Be carful when using a data.table grouping option </span>
<span class="co"># because of lack of protection against collinearity or low number of observations. </span>
<span class="co"># There could be used a tryCatch(fill_NA(...),error=function(e) return(...))</span>

  <span class="no">.</span>[,<span class="no">Ozone_chac_imp</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                                 <span class="kw">model</span><span class="kw">=</span><span class="st">"lda"</span>,
                                 <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone_chac'</span>,
                                 <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'Month'</span>,<span class="st">'Day'</span>,<span class="st">'Temp'</span>,<span class="st">'x_character_imp'</span>),
                                 <span class="kw">w</span><span class="kw">=</span><span class="no">.SD</span><span class="kw">[[</span><span class="st">'weights'</span>]]),
                                <span class="kw">error</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">e</span>) <span class="no">.SD</span><span class="kw">[[</span><span class="st">'Ozone_chac'</span>]]),<span class="fu">.</span>(<span class="no">groups</span>)]</pre></body></html></div>
</div>
<div id="intro-dplyr" class="section level3">
<h3 class="hasAnchor">
<a href="#intro-dplyr" class="anchor"></a>Intro: dplyr</h3>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># VIF - values bigger than 10 (around) suggest that there might be a collinearity problem.</span>
<span class="co"># VIF is high for Solar.R and x_character which is obvious - x_character is a factor version of numeric Solar.R</span>
<span class="no">air_miss</span> <span class="kw">%&gt;%</span> <span class="fu">do</span>(<span class="kw">vifs</span><span class="kw">=</span><span class="fu"><a href="../reference/VIF.html">VIF</a></span>(<span class="no">.</span>,<span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                           <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Solar.R'</span>,
                                     <span class="st">'Wind'</span>,
                                     <span class="st">'Temp'</span>,
                                     <span class="st">'x_character'</span>,
                                     <span class="st">'Day'</span>,
                                     <span class="st">'weights'</span>,
                                     <span class="st">'groups'</span>))) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>()</pre></body></html></div>
<pre><code>##     vifs1     vifs2     vifs3     vifs4     vifs5     vifs6     vifs7 
## 24.978996  1.445308  3.077776 42.248792  1.083795  1.100853  2.954588</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># IMPUTATIONS</span>
<span class="no">air_miss</span> <span class="kw">=</span> <span class="no">air_miss</span> <span class="kw">%&gt;%</span>
<span class="co"># Imputations with a grouping option (models are separately assessed for each group) </span>
<span class="co"># taking into account provided weights</span>
<span class="fu">group_by</span>(<span class="no">groups</span>) <span class="kw">%&gt;%</span>
<span class="fu">do</span>(<span class="fu">mutate</span>(<span class="no">.</span>,<span class="kw">Solar_R_imp</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                                  <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_pred"</span>,
                                  <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Solar.R'</span>,
                                  <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Wind'</span>,<span class="st">'Temp'</span>,<span class="st">'Intercept'</span>),
                                  <span class="kw">w</span><span class="kw">=</span><span class="no">.</span><span class="kw">[[</span><span class="st">'weights'</span>]]))) <span class="kw">%&gt;%</span>
<span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
<span class="co"># Imputations - discrete variable</span>
<span class="fu">mutate</span>(<span class="kw">x_character_imp</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                                 <span class="kw">model</span><span class="kw">=</span><span class="st">"lda"</span>,
                                 <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'x_character'</span>,
                                 <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Wind'</span>,<span class="st">'Temp'</span>))) <span class="kw">%&gt;%</span>
<span class="co"># logreg was used because almost log-normal distribution of Ozone</span>
<span class="co"># imputations around mean</span>
<span class="fu">mutate</span>(<span class="kw">Ozone_imp1</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                            <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                            <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                            <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>),
                            <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>)) <span class="kw">%&gt;%</span>
<span class="co"># imputations using positions - Intercept, Temp</span>
<span class="fu">mutate</span>(<span class="kw">Ozone_imp2</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                            <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                            <span class="kw">posit_y</span><span class="kw">=</span><span class="fl">1</span>,
                            <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">6</span>),
                            <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>)) <span class="kw">%&gt;%</span>
<span class="co"># multiple imputations (average of x30 imputations) </span>
<span class="co"># with a factor independent variable, weights and logreg options</span>
<span class="fu">mutate</span>(<span class="kw">Ozone_imp3</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA_N.html">fill_NA_N</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                              <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_noise"</span>,
                              <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                              <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                              <span class="kw">w</span><span class="kw">=</span><span class="no">.</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                              <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>,
                              <span class="kw">times</span><span class="kw">=</span><span class="fl">30</span>)) <span class="kw">%&gt;%</span>
<span class="fu">mutate</span>(<span class="kw">Ozone_imp4</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA_N.html">fill_NA_N</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                              <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_bayes"</span>,
                              <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                              <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                              <span class="kw">w</span><span class="kw">=</span><span class="no">.</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                              <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>,
                              <span class="kw">times</span><span class="kw">=</span><span class="fl">30</span>)) <span class="kw">%&gt;%</span>
<span class="fu">group_by</span>(<span class="no">groups</span>) <span class="kw">%&gt;%</span>
<span class="fu">do</span>(<span class="fu">mutate</span>(<span class="no">.</span>,<span class="kw">Ozone_imp5</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                                 <span class="kw">model</span><span class="kw">=</span><span class="st">"lm_pred"</span>,
                                 <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                                 <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'x_character_imp'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>),
                                 <span class="kw">w</span><span class="kw">=</span><span class="no">.</span><span class="kw">[[</span><span class="st">'weights'</span>]],
                                 <span class="kw">logreg</span><span class="kw">=</span><span class="fl">TRUE</span>))) <span class="kw">%&gt;%</span>
<span class="fu">ungroup</span>() <span class="kw">%&gt;%</span>
<span class="co"># Average of a few methods</span>
<span class="fu">mutate</span>(<span class="kw">Ozone_imp_mix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="fu">select</span>(<span class="no">.</span>,<span class="fu">starts_with</span>(<span class="st">"Ozone_imp"</span>)))) <span class="kw">%&gt;%</span>

<span class="co"># Protecting against collinearity or low number of observations - across small groups</span>
<span class="co"># Be carful when using a data.table grouping option </span>
<span class="co"># because of lack of protection against collinearity or low number of observations. </span>
<span class="co"># There could be used a tryCatch(fill_NA(...),error=function(e) return(...))</span>
<span class="fu">group_by</span>(<span class="no">groups</span>) <span class="kw">%&gt;%</span>
<span class="fu">do</span>(<span class="fu">mutate</span>(<span class="no">.</span>,<span class="kw">Ozone_chac_imp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="fu"><a href="../reference/fill_NA.html">fill_NA</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.</span>,
                                       <span class="kw">model</span><span class="kw">=</span><span class="st">"lda"</span>,
                                       <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone_chac'</span>,
                                       <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Intercept'</span>,<span class="st">'Month'</span>,<span class="st">'Day'</span>,<span class="st">'Temp'</span>,<span class="st">'x_character_imp'</span>),
                                       <span class="kw">w</span><span class="kw">=</span><span class="no">.</span><span class="kw">[[</span><span class="st">'weights'</span>]]),
                                      <span class="kw">error</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">e</span>) <span class="no">.</span><span class="kw">[[</span><span class="st">'Ozone_chac'</span>]]))) <span class="kw">%&gt;%</span>
<span class="fu">ungroup</span>()</pre></body></html></div>
</div>
<div id="results---visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#results---visualization" class="anchor"></a>results - visualization</h3>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Distribution of imputations vs Distribution of initial data</span>
<span class="no">air_miss</span>$<span class="no">Ozone_NA</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">air_miss</span>$<span class="no">Ozone</span>),<span class="st">'imputations'</span>,<span class="st">'complete'</span>)
<span class="no">air_miss</span> <span class="kw">=</span> <span class="fu">as.data.table</span>(<span class="no">air_miss</span>)

<span class="no">air_miss</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Ozone'</span>,<span class="st">'Ozone_imp_mix'</span>,<span class="st">'Ozone_NA'</span>)] <span class="kw">%&gt;%</span>
<span class="fu">melt</span>(<span class="kw">id</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Ozone_NA'</span>),<span class="kw">measure</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Ozone'</span>,<span class="st">'Ozone_imp_mix'</span>)) <span class="kw">%&gt;%</span>
<span class="no">.</span>[(((<span class="no">Ozone_NA</span><span class="kw">==</span><span class="st">'imputations'</span>) <span class="kw">&amp;</span> (<span class="no">variable</span><span class="kw">==</span><span class="st">'Ozone_imp_mix'</span>))<span class="kw">|</span>((<span class="no">Ozone_NA</span><span class="kw">==</span><span class="st">'complete'</span>) <span class="kw">&amp;</span> (<span class="no">variable</span><span class="kw">==</span><span class="st">'Ozone'</span>))),] <span class="kw">%&gt;%</span>
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">.</span>,<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">value</span>,<span class="kw">fill</span><span class="kw">=</span><span class="no">variable</span>)) +
<span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() + <span class="kw pkg">ggplot2</span><span class="kw ns">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="no">Ozone_NA</span> ~<span class="no">.</span>,<span class="kw">scales</span><span class="kw">=</span><span class="st">'free'</span>)</pre></body></html></div>
<p><img src="miceFast-intro_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="genereting-data-with-the-corrdata-module" class="section level2">
<h2 class="hasAnchor">
<a href="#genereting-data-with-the-corrdata-module" class="anchor"></a>Genereting data with the corrData Module</h2>
<p>Available constructors:</p>
<p><code>new(corrData,nr_cat,n_obs,means,cor_matrix)</code></p>
<p><code>new(corrData,n_obs,means,cor_matrix)</code></p>
<p>where:</p>
<ul>
<li>
<code>nr_cat</code> : number of categories for discrete dependent variable</li>
<li>
<code>n_obs</code> : number of observations</li>
<li>
<code>means</code>: center independent variables</li>
<li>
<code>cor_mat</code> : positive defined correlation matrix</li>
</ul>
<p>relevant class methods:</p>
<ul>
<li>
<code>fill("type")</code> : generating data [return a numeric matrix] - data with correlated variables where first variable is of binomial,discrete or continuous type.</li>
</ul>
<p><code>type</code>:character - possible options (“contin”,“binom”,“discrete”)</p>
</div>
<div id="imputing-data-with-the-micefast-module" class="section level2">
<h2 class="hasAnchor">
<a href="#imputing-data-with-the-micefast-module" class="anchor"></a>Imputing data with the miceFast Module:</h2>
<p>Available constructors:</p>
<p><code>new(miceFast)</code></p>
<p>relevant class methods:</p>
<ul>
<li>
<code>set_data(x)</code> - providing the data by a reference - a numeric matrix [void]</li>
<li>
<code>get_data()</code> - retrieving the data [return a numeric matrix] - the same values as provided by reference x, recommended to use x directly</li>
<li>
<code>set_g(g)</code> - providing the grouping variable by a reference - a numeric vector - positive values [void]</li>
<li>
<code>get_g()</code> - retrieving the grouping variable [return a numeric vector] - the same values as provided by reference g, recommended to use g directly</li>
<li>
<code>set_w(w)</code> - providing the weighting variable by a reference - a numeric vector - positive values</li>
<li>
<code>get_w()</code> - retrieving the weighting variable [return a numeric vector] - the same values as provided by reference w, recommended to use w directly</li>
<li>
<code>get_index()</code> - getting the index [return a integer vector] - useful after automatic sorting procedure</li>
<li>
<code>impute("model",posit_y,posit_x)</code> - impute data under characteristics form object like a optional grouping or weighting variable [return a list with 3 vectors: a numeric vector “imputations” dependent variable with replaced Na values, a integer vector “index_imputed” positions where data was imputed, a integer vector “index_full” positions which were used to assess the model]</li>
<li>
<code>impute_N("model2",posit_y,posit_x,times)</code> - multiple imputations - impute data under characteristics form object like a optional grouping or weighting variable - works for (“lm_bayes”,“lm_noise”) - [return a list with 3 vectors: a numeric vector “imputations” dependent variable with replaced Na values by average of N results, a integer vector “index_imputed” positions where data was imputed, a integer vector “index_full” positions which were used to assess the model]</li>
<li>
<code>update_var(posit_y,imputations)</code> - permanently update variable at the object and data. WARNING, use it only if you are sure about model parameters. [void]</li>
<li>
<code>get_models()</code> - possible quantitative models for a certain type of dependent variable [return a character vector: recommended models for impute and impute_N methods]</li>
<li>
<code>get_model()</code> - a recommended quantitative model for a certain type of dependent variable [return a character: recommended model for impute and impute_N methods] - useful while looping</li>
<li>
<code>which_updated()</code> - which variables were modified by update_var at the object (and data) [return a integer vector: positions at provided data at which variables were update by update_var method]</li>
<li>
<code>sort_byg()</code> - sort data by the grouping variable [void]</li>
<li>
<code>is_sorted_byg()</code> - is data sorted by the grouping variable [void]</li>
<li>
<code>vifs(posit_y,posit_x)</code> - Variance inflation factors (VIF) [return a numeric vector: VIF for all variables provided by posit_x] <code>x</code> : numeric matrix - variables<br><code>g</code> : numeric vector - you could build it form several discrete variables<br><code>w</code>: numeric vector with positive values - weights for weighted linear regressions<br><code>model</code>: character - a possible options (“lda”,“lm_pred”,“lm_bayes”,“lm_noise”)<br><code>posit_y</code>: integer - a position of dependent variable<br><code>posit_x</code>: integer vector - positions of independent variables<br><code>imputations</code> : numeric vector - imputations<br><code>times</code> : integer - number of multiple imputations</li>
</ul>
<p><em>For a simple mean imputations add intercept to data and use “lm_pred”</em><br><em>The lda model is assessed only if there are more than 15 complete observations and for the lms models if the number of independent variables is smaller than the number of observations.</em></p>
<div style="page-break-after: always;"></div>
<p>###Imputations</p>
<p><strong>miceFast module usage:</strong></p>
<p>Remember that a matrix could be build only under a one data type so factor variables have to be melted use <code>model.matrix</code> to get numeric matrix from <code>data.frame</code> - see Tips in this document</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co">#install.packages("mice")</span>
<span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw pkg">mice</span><span class="kw ns">::</span><span class="no"><a href="http://stefvanbuuren.github.io/mice/reference/nhanes.html">nhanes</a></span>),<span class="kw">intercept</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">index</span><span class="kw">=</span><span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw pkg">mice</span><span class="kw ns">::</span><span class="no"><a href="http://stefvanbuuren.github.io/mice/reference/nhanes.html">nhanes</a></span>))
<span class="no">model</span> <span class="kw">=</span> <span class="fu">new</span>(<span class="no">miceFast</span>)
<span class="no">model</span>$<span class="fu">set_data</span>(<span class="no">data</span>) <span class="co">#providing data by a reference</span>

<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">2</span>,<span class="no">model</span>$<span class="fu">impute</span>(<span class="st">"lm_pred"</span>,<span class="fl">2</span>,<span class="fl">5</span>)$<span class="no">imputations</span>)
<span class="co">#OR not recommended</span>
<span class="co">#data[,2] = model$impute("lm_pred",2,5)$imputations</span>
<span class="co">#model$set_data(data) #Updating the object</span>

<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">3</span>,<span class="no">model</span>$<span class="fu">impute</span>(<span class="st">"lda"</span>,<span class="fl">3</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))$<span class="no">imputations</span>)

<span class="co">#Old slow syntax model$update_var(4,rowMeans(sapply(1:10,function(x) model$impute("lm_bayes",4,c(1,2,3))$imputations)))</span>
<span class="co">#New syntax - impute_N</span>
<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">4</span>,<span class="no">model</span>$<span class="fu">impute_N</span>(<span class="st">"lm_bayes"</span>,<span class="fl">4</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>),<span class="fl">10</span>)$<span class="no">imputations</span>)

<span class="co">#When working with 'Big Data'</span>
<span class="co">#it is recommended to occasionally manually invoke a garbage collector `gc()`</span>

<span class="co"># Be careful with `update_var` because of the permanent update at the object and data</span>
<span class="co"># That is why `update_var` could be used only ones for a certain column</span>
<span class="co"># check which variables was updated - inside the object</span>
<span class="no">model</span>$<span class="fu">which_updated</span>()</pre></body></html></div>
<pre><code>## [1] 2 3 4</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">model</span>$<span class="fu">get_data</span>(),<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##      [,1]    [,2] [,3]     [,4] [,5] [,6]
## [1,]    1 26.5625    1 159.0947    1    1
## [2,]    2 22.7000    1 187.0000    1    2
## [3,]    1 26.5625    1 187.0000    1    3</code></pre>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">data</span>,<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##   age     bmi hyp      chl intercept index
## 1   1 26.5625   1 159.0947         1     1
## 2   2 22.7000   1 187.0000         1     2
## 3   1 26.5625   1 187.0000         1     3</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw pkg">mice</span><span class="kw ns">::</span><span class="no"><a href="http://stefvanbuuren.github.io/mice/reference/nhanes.html">nhanes</a></span>,<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##   age  bmi hyp chl
## 1   1   NA  NA  NA
## 2   2 22.7   1 187
## 3   1   NA   1 187</code></pre>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">model</span>)</pre></body></html></div>
<div style="page-break-after: always;"></div>
<p><strong>Model with additional parameters:</strong> - data sorted by the grouping variable</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">airquality</span>[,-<span class="fl">5</span>]),<span class="kw">intercept</span><span class="kw">=</span><span class="fl">1</span>,<span class="kw">index</span><span class="kw">=</span><span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">airquality</span>))
<span class="no">weights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data</span>),<span class="fl">3</span>,<span class="fl">3</span>) <span class="co"># a numeric vector - positive values</span>
<span class="no">groups</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">airquality</span>[,<span class="fl">5</span>]) <span class="co"># a numeric vector not integers - positive values - sorted increasingly</span>

<span class="no">model</span> <span class="kw">=</span> <span class="fu">new</span>(<span class="no">miceFast</span>)
<span class="no">model</span>$<span class="fu">set_data</span>(<span class="no">data</span>) <span class="co"># providing data by a reference</span>
<span class="no">model</span>$<span class="fu">set_w</span>(<span class="no">weights</span>) <span class="co"># providing by a reference</span>
<span class="no">model</span>$<span class="fu">set_g</span>(<span class="no">groups</span>)  <span class="co"># providing by a reference</span>

<span class="co">#impute adapt to provided parmaters like w or g</span>
<span class="co">#Simple mean - permanent imputation at the object and data</span>
<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">1</span>,<span class="no">model</span>$<span class="fu">impute</span>(<span class="st">"lm_pred"</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">6</span>))$<span class="no">imputations</span>)

<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">2</span>,<span class="no">model</span>$<span class="fu">impute_N</span>(<span class="st">"lm_bayes"</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>),<span class="fl">10</span>)$<span class="no">imputations</span>)

<span class="co">#Printing data and retrieving an old order</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">model</span>$<span class="fu">get_data</span>(),<span class="no">model</span>$<span class="fu">get_g</span>(),<span class="no">model</span>$<span class="fu">get_w</span>())[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="no">model</span>$<span class="fu">get_index</span>()),],<span class="fl">4</span>)</pre></body></html></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]      [,9]
## [1,]   41  190  7.4   67    1    1    1    5 1.2809043
## [2,]   36  118  8.0   72    2    1    2    5 0.3350294
## [3,]   12  149 12.6   74    3    1    3    5 0.1997905
## [4,]   18  313 11.5   62    4    1    4    5 0.9479004</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">airquality</span>,<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">model</span>$<span class="fu">get_data</span>(),<span class="no">model</span>$<span class="fu">get_g</span>(),<span class="no">model</span>$<span class="fu">get_w</span>()),<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]      [,9]
## [1,]   41  190  7.4   67    1    1    1    5 1.2809043
## [2,]   36  118  8.0   72    2    1    2    5 0.3350294
## [3,]   12  149 12.6   74    3    1    3    5 0.1997905</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">data</span>,<span class="no">groups</span>,<span class="no">weights</span>),<span class="fl">3</span>)</pre></body></html></div>
<pre><code>##      Ozone Solar.R Wind Temp Day intercept index groups   weights
## [1,]    41     190  7.4   67   1         1     1      5 1.2809043
## [2,]    36     118  8.0   72   2         1     2      5 0.3350294
## [3,]    12     149 12.6   74   3         1     3      5 0.1997905</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">model</span>)</pre></body></html></div>
<div style="page-break-after: always;"></div>
<p><strong>Model with additional parameters:</strong> - data not sorted by the grouping variable</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">airquality</span>[,-<span class="fl">5</span>]),<span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">1</span>,<span class="kw">index</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">airquality</span>))
<span class="no">weights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data</span>),<span class="fl">3</span>,<span class="fl">3</span>) <span class="co"># a numeric vector - positive values</span>
<span class="co">#groups = as.numeric(airquality[,5]) # a numeric vector not integers - positive values</span>
<span class="no">groups</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">8</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">data</span>),<span class="kw">replace</span><span class="kw">=</span><span class="no">T</span>)) <span class="co"># a numeric vector not integers - positive values</span>

<span class="no">model</span> <span class="kw">=</span> <span class="fu">new</span>(<span class="no">miceFast</span>)
<span class="no">model</span>$<span class="fu">set_data</span>(<span class="no">data</span>) <span class="co"># providing by a reference</span>
<span class="no">model</span>$<span class="fu">set_w</span>(<span class="no">weights</span>) <span class="co"># providing by a reference</span>
<span class="no">model</span>$<span class="fu">set_g</span>(<span class="no">groups</span>)  <span class="co"># providing by a reference</span>
<span class="co">#impute adapt to provided parmaters like w or g</span>
<span class="co">#Warning - if data is not sorted increasingly by the g then it would be done automatically </span>
<span class="co">#during a first imputation</span>
<span class="co">#Simple mean - permanent imputation at the object and data</span>
<span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">1</span>,<span class="no">model</span>$<span class="fu">impute</span>(<span class="st">"lm_pred"</span>,<span class="fl">1</span>,<span class="fl">6</span>)$<span class="no">imputations</span>)</pre></body></html></div>
<pre><code>## Warning in model$impute("lm_pred", 1, 6): 
##  Data was sorted by the grouping variable - use `get_index()` to retrieve an order</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">model</span>$<span class="fu">update_var</span>(<span class="fl">2</span>,<span class="no">model</span>$<span class="fu">impute_N</span>(<span class="st">"lm_bayes"</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>),<span class="fl">10</span>)$<span class="no">imputations</span>)

<span class="co">#Printing data and retrieving an old order</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">model</span>$<span class="fu">get_data</span>(),<span class="no">model</span>$<span class="fu">get_g</span>(),<span class="no">model</span>$<span class="fu">get_w</span>())[<span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="no">model</span>$<span class="fu">get_index</span>()),],<span class="fl">4</span>)</pre></body></html></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]      [,9]
## [1,]   41  190  7.4   67    1    1    1    4 1.4921661
## [2,]   36  118  8.0   72    2    1    2    3 1.0500448
## [3,]   12  149 12.6   74    3    1    3    1 0.9895894
## [4,]   18  313 11.5   62    4    1    4    8 0.9625453</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">airquality</span>,<span class="fl">4</span>)</pre></body></html></div>
<pre><code>##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3
## 4    18     313 11.5   62     5   4</code></pre>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">model</span>$<span class="fu">get_data</span>(),<span class="no">model</span>$<span class="fu">get_g</span>(),<span class="no">model</span>$<span class="fu">get_w</span>()),<span class="fl">4</span>) <span class="co">#is ordered by g</span></pre></body></html></div>
<pre><code>##          [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]      [,9]
## [1,] 12.00000  149 12.6   74    3    1    3    1 0.9895894
## [2,] 14.00000  334 11.5   64   16    1   16    1 2.0194411
## [3,] 41.28856  266 14.9   58   26    1   26    1 0.6032170
## [4,] 37.00000  279  7.4   76   31    1   31    1 0.6498725</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">data</span>,<span class="no">groups</span>,<span class="no">weights</span>),<span class="fl">4</span>) <span class="co">#is sorted by g cause we provide data by a reference</span></pre></body></html></div>
<pre><code>##         Ozone Solar.R Wind Temp Day intercept index groups   weights
## [1,] 12.00000     149 12.6   74   3         1     3      1 0.9895894
## [2,] 14.00000     334 11.5   64  16         1    16      1 2.0194411
## [3,] 41.28856     266 14.9   58  26         1    26      1 0.6032170
## [4,] 37.00000     279  7.4   76  31         1    31      1 0.6498725</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">model</span>)</pre></body></html></div>
<div style="page-break-after: always;"></div>
<div id="tips" class="section level3">
<h3 class="hasAnchor">
<a href="#tips" class="anchor"></a>Tips</h3>
<p><strong>matrix from data.frame</strong></p>
<p>Remember that a matrix could be build only under a one data type so factor/character variables have to be melted. Sb could use <code>model.matrix</code> to get numeric matrix from a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="co">#str(mtcars)</span>
<span class="no">mtcars</span>$<span class="no">cyl</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">mtcars</span>$<span class="no">cyl</span>)
<span class="no">mtcars</span>$<span class="no">gear</span><span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">mtcars</span>$<span class="no">gear</span>)
<span class="no">mtcars_mat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix.lm</a></span>(~<span class="no">.</span>,<span class="no">mtcars</span>,<span class="kw">na.action</span><span class="kw">=</span><span class="st">"na.pass"</span>)
<span class="co">#str(mtcars_mat)</span></pre></body></html></div>
<p><strong>Variance inflation factors (VIF)</strong></p>
<p>VIF measure how much the variance of the estimated regression coefficients are inflated. It helps to identify when the predictor variables are linearly related. You have to decide which variable should be delete. Values higher than 10 signal a potential collinearity problem.</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">airquality2</span> <span class="kw">=</span> <span class="no">airquality</span>
<span class="no">airquality2</span>$<span class="no">Temp2</span> <span class="kw">=</span> <span class="no">airquality2</span>$<span class="no">Temp</span>**<span class="fl">2</span>
<span class="no">airquality2</span>$<span class="no">Month</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">airquality2</span>$<span class="no">Month</span>)

<span class="kw pkg">car</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">Ozone</span> ~ <span class="no">.</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">airquality2</span>))</pre></body></html></div>
<pre><code>##               GVIF Df GVIF^(1/(2*Df))
## Solar.R   1.230156  1        1.109124
## Wind      1.415414  1        1.189712
## Temp    264.800283  1       16.272685
## Month     2.774325  4        1.136043
## Day       1.038574  1        1.019105
## Temp2   249.766363  1       15.803998</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">data_DT</span> <span class="kw">=</span> <span class="fu">data.table</span>(<span class="no">airquality2</span>)
<span class="no">data_DT</span>[,<span class="fu">.</span>(<span class="kw">vifs</span><span class="kw">=</span><span class="fu"><a href="../reference/VIF.html">VIF</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                <span class="kw">posit_y</span><span class="kw">=</span><span class="st">'Ozone'</span>,
                <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Solar.R'</span>,<span class="st">'Wind'</span>,<span class="st">'Temp'</span>,<span class="st">'Month'</span>,<span class="st">'Day'</span>,<span class="st">'Temp2'</span>),<span class="kw">correct</span><span class="kw">=</span><span class="fl">FALSE</span>))]<span class="kw">[[</span><span class="st">'vifs'</span>]]</pre></body></html></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">data_DT</span>[,<span class="fu">.</span>(<span class="kw">vifs</span><span class="kw">=</span><span class="fu"><a href="../reference/VIF.html">VIF</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">.SD</span>,
                <span class="kw">posit_y</span><span class="kw">=</span><span class="fl">1</span>,
                <span class="kw">posit_x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>),<span class="kw">correct</span><span class="kw">=</span><span class="fl">TRUE</span>))]<span class="kw">[[</span><span class="st">'vifs'</span>]]</pre></body></html></div>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="bibliography" class="section level2">
<h2 class="hasAnchor">
<a href="#bibliography" class="anchor"></a>Bibliography</h2>
<p>URL: <a href="http://dirk.eddelbuettel.com/code/rcpp/Rcpp-modules.pdf" class="uri">http://dirk.eddelbuettel.com/code/rcpp/Rcpp-modules.pdf</a><br>
Title: Exposing C++ functions and classes with Rcpp modules Dirk Eddelbuettel and Romain François<br>
Author: <a href="http://dirk.eddelbuettel.com" class="uri">http://dirk.eddelbuettel.com</a> and <a href="https://romain.rbind.io/" class="uri">https://romain.rbind.io/</a><br>
Date: March 8, 2018</p>
<p>URL: <a href="http://dirk.eddelbuettel.com/papers/RcppArmadillo-intro.pdf" class="uri">http://dirk.eddelbuettel.com/papers/RcppArmadillo-intro.pdf</a><br>
Title: RcppArmadillo: Easily Extending R with High-Performance C++ Code<br>
Author: Dirk Eddelbuettel and Conrad Sanderson<br>
Date: July 1, 2012</p>
<p>URL: <a href="http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf" class="uri">http://dirk.eddelbuettel.com/code/rcpp/Rcpp-introduction.pdf</a><br>
Title: Extending R with C++: A Brief Introduction to Rcpp<br>
Author: Dirk Eddelbuettel and James Joseph Balamuta<br>
Date: March 8, 2018</p>
<p>Title: MICE: Multivariate Imputation by Chained Equations in R<br>
Author: Stef van Buuren<br>
Date: 2013</p>
<p>Title: CSCE 666: Pattern Analysis<br>
Author: Ricardo Gutierrez-Osuna<br>
Date: Fall 2013</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Environment: MRO 3.5.3 Intel MKL - i7 6700HQ and 24GB DDR4 2133. MRO (Microsoft R Open) provide to R a sophisticated library for linear algebra operations so remember about that when reading a performance comparison.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Maciej Nasinski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
